<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>SWEngine: Potok przetwarzania obiektów</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">SWEngine
   &#160;<span id="projectnumber">Wersja 1.008</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Potok przetwarzania obiektów </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="Contents"></a>
Spis Treści</h1>
<ul>
<li><a class="el" href="_object_pipeline.html#Code">Kod</a></li>
<li><a class="el" href="_object_pipeline.html#generalInfo">Ogólne informacje</a></li>
<li><a class="el" href="_object_pipeline.html#pipelineScheme">Schemat potoku przetwarzania obiektów</a></li>
</ul>
<h2><a class="anchor" id="Code"></a>
Kod</h2>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="class_engine.html#aa5dc46f13a43784e7fc111b92f40f1d6">Engine::render_frame</a>()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">float</span> time_interval = <a class="code" href="class_engine_interface.html#ae30a81be91a8dd4648203d2329b8381c">time_manager</a>.<a class="code" href="class_time_manager.html#a18fd77e0b160cb67a0628e8a14a28028">onStartRenderFrame</a>();</div>
<div class="line">    <span class="keywordtype">float</span> lag = <a class="code" href="class_engine_interface.html#ae30a81be91a8dd4648203d2329b8381c">time_manager</a>.<a class="code" href="class_time_manager.html#a16d658c26266b4bf3a9459fa4115d3e3">getTimeLag</a>();</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">while</span> ( lag &gt;= <a class="code" href="_engine_8cpp.html#af21c7ca8d255e6d2cb812ef0eb378f7f">FIXED_MOVE_UPDATE_INTERVAL</a> )</div>
<div class="line">    {</div>
<div class="line">        START_PERFORMANCE_CHECK(FRAME_COMPUTING_TIME)</div>
<div class="line"></div>
<div class="line">        <a class="code" href="class_engine_interface.html#adc3fc8d70a1d9b6770dfba033b5b4f37">ui_engine</a>-&gt;proceed_input( <a class="code" href="_engine_8cpp.html#af21c7ca8d255e6d2cb812ef0eb378f7f">FIXED_MOVE_UPDATE_INTERVAL</a> );</div>
<div class="line">        <a class="code" href="class_engine_interface.html#a08574dc42032dfcbfb0e81b8fc32494d">physic_engine</a>-&gt;proceed_physic( FIXED_MOVE_UPDATE_INTERVAL );</div>
<div class="line">        <a class="code" href="class_engine_interface.html#a7e28bc7ca2a5a349bb3e2247b384a231">controllers_engine</a>-&gt;proceed_controllers_pre( FIXED_MOVE_UPDATE_INTERVAL );</div>
<div class="line">        <a class="code" href="class_engine_interface.html#ac3b3f666f060612a681cad2398760fb8">movement_engine</a>-&gt;proceed_movement( FIXED_MOVE_UPDATE_INTERVAL );</div>
<div class="line">        <a class="code" href="class_engine_interface.html#a7e28bc7ca2a5a349bb3e2247b384a231">controllers_engine</a>-&gt;proceed_controllers_post( FIXED_MOVE_UPDATE_INTERVAL );</div>
<div class="line">        <a class="code" href="class_engine_interface.html#a3d4e298ebc284dd43a96914e00af29e5">collision_engine</a>-&gt;proceed_collisions( FIXED_MOVE_UPDATE_INTERVAL );</div>
<div class="line">        <a class="code" href="class_engine_interface.html#ab0d767baa0f337a5053323af4b43a5f8">fable_engine</a>-&gt;proceed_fable( FIXED_MOVE_UPDATE_INTERVAL );</div>
<div class="line"></div>
<div class="line">        lag -= FIXED_MOVE_UPDATE_INTERVAL;</div>
<div class="line">        <a class="code" href="class_engine_interface.html#ae30a81be91a8dd4648203d2329b8381c">time_manager</a>.updateTimeLag( lag );</div>
<div class="line"></div>
<div class="line">        END_PERFORMANCE_CHECK( FRAME_COMPUTING_TIME )</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef _INTERPOLATE_POSITIONS</span></div>
<div class="line">    START_PERFORMANCE_CHECK( INTERPOLATION_TIME )</div>
<div class="line"></div>
<div class="line">    <a class="code" href="class_engine_interface.html#ad41a553cec70cf6e29d9663365f1a059">display_engine</a>-&gt;interpolate_positions( lag / FIXED_MOVE_UPDATE_INTERVAL );</div>
<div class="line"></div>
<div class="line">    END_PERFORMANCE_CHECK( INTERPOLATION_TIME )</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"></div>
<div class="line">    START_PERFORMANCE_CHECK(RENDERING_TIME)</div>
<div class="line"></div>
<div class="line">    <span class="comment">//Renderujemy scenę oraz interfejs użytkownika</span></div>
<div class="line">    begin_scene();</div>
<div class="line"></div>
<div class="line">    <a class="code" href="class_engine_interface.html#ad41a553cec70cf6e29d9663365f1a059">display_engine</a>-&gt;display_scene( time_interval, lag / FIXED_MOVE_UPDATE_INTERVAL );</div>
<div class="line">    <a class="code" href="class_engine_interface.html#adc3fc8d70a1d9b6770dfba033b5b4f37">ui_engine</a>-&gt;draw_GUI( time_interval, lag / FIXED_MOVE_UPDATE_INTERVAL );</div>
<div class="line"></div>
<div class="line">    END_PERFORMANCE_CHECK( RENDERING_TIME )     </div>
<div class="line"></div>
<div class="line">    end_scene_and_present();</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="generalInfo"></a>
Ogólne informacje</h2>
<p>Za potok przetwarzania obiektów odpowiada funkcja <a class="el" href="class_engine.html#aa5dc46f13a43784e7fc111b92f40f1d6" title="To tutaj dzieją się wszystkie rzeczy, które są wywoływane co każdą klatkę. ">Engine::render_frame</a>. Funkcja ta jest wywoływana w pętli głównej silnika, konkretniej w funkcji <a class="el" href="class_engine.html#a28609462aae6189be2b5ed4d8ecfbae5" title="Główna pętla programu. Pętla główna silnika. ">Engine::main_loop</a>, w każdym możliwym momencie, kiedy nie są przetwarzane komunikaty z kolejki komunikatów WinApi.</p>
<p>Funkcja wywołuje w odpowiedniej kolejności poszczególne moduły silnika. Moduły odpowiedzialne za ruch obiektów na scenie i ich interakcje wywoływane są ze stałą częstotliwością określoną przez stałą FIXED_MOVE_UPDATE_INTERVAL. Oznacza to, że w niektórych obiegach pętli mogą nie zostać wywołane, jeżeli odległość w czasie od odstatniego wywołania jest za mała. Taka architektura ma na celu spowodowanie, żeby gra działała tak samo zarówno na szybkim sprzęcie jak i na wolnym. Zauważmy, że jedno przesunięcie obiektów po czasie t, nie jest równoważne dwóm przesunięciom po czasie t/2. Dzieje się tak ze względu na niedokładność obliczeń wykonywanych na floatach. O ile w tym przypadku różnice nie muszą być duże, to różnica zachowania sztucznej inteligencji w tych dwóch sytuacjach jest nie do przewidzenia. Za pomocą tego samego mechanizmu realizowane jest pauzowanie gry. Wtedy czas nie przyrasta, więc odpowiednie bloki nie zostają wywołane.</p>
<dl class="deprecated"><dt><b><a class="el" href="deprecated.html#_deprecated000001">Deprecated:</a></b></dt><dd>Moduły silnika odpowiedzialne za renderowanie obiektów, GUI oraz przechwytywanie urządzeń wejściowych są wywoływane w każdym obiegu pętli. Obsługa eventów wywoływana jest według schematu dwukrotnie. Jest to konieczne, gdyż chcemy obsługiwać eventy także wtedy, kiedy jesteśmy w trybie pauzy. Nie możemy zabrać obsługi eventów z bloku wykonywanego warunkowo, ponieważ po każdym przeliczeniu położeń i parametrów obiektów, mogą zostać wygenerowane nowe zdarzenia, które trzeba obsłużyć. Blok może zostać wtedy ponownie wykonany, z powodu opóźnienia. W takiej sytuacji obsługa eventów poza pętlą odbyłaby się za późno. Z tych względów musimy wywołać obsługę zarówno po każdym obiegu bloku warunkowego jak i po wyjściu z niego. Nie powoduje to żadnego spowolnienia. Nadmiarowa procedura natrafia w takim wypadku na pustą kolejkę eventów i natychmiast powraca.</dd></dl>
<p>Jak widać ze schematu obsługa kontrolerów podzielona jest na dwie części: kontrolery pre i kontrolery post. Dla niektórych grup kotrolerów wymagane jest, aby pozycje pozostałych obiektów dynamicznych był już znane, inne mają wpływ na późniejsze przeliczenie pozycji, dlatego muszą być wywołane wcześniej. Aby przeczytać więcej o tym temacie odsyłam do <a class="el" href="_controllers.html#PrePostControllers">Kotrolery pre i post</a>.</p>
<p>Renderowanie klatki podzielone jest na dwa etapy: pierwszym jest renderowanie sceny, drugim renderowanie graficznego interfejsu użytkownika. Aby dowiedzieć się więcej zalecam przeczytać tematy: <a class="el" href="_scene_render.html">Renderowanie sceny</a> i <a class="el" href="_g_u_i_render.html">Renderowanie GUI</a>. Ze względu na to, że funkcje BeginScene i EndScene mogą być wywołane tylko raz podczas renderowania jednej klatki, dzieje się to na tym poziomie, nie wenątrz jednej z tych funkcji. Podobnie na tym poziomie realizowane jest czyszczenie bufora kolorów oraz z-bufora.</p>
<p>Funkcja <a class="el" href="class_engine.html#abb1d45fdc30d56a4cbd9b58c2c1476ed" title="Funkcja oblicza interwał czasowy jaki upłynął od ostatniej ramki. Poza tym są tu generowane eventy do...">Engine::time_controller</a> wywoływana na początku robi dwie rzeczy. Po pierwsze liczy czas jaki upłynął od ostatniego wywołania i ustawia zmienną lag. Przy ustawianiu bierze pod uwagę czy jesteśmy w trybie pauzy czy nie, w związku z czym na tym poziomie nie musimy się o nic martwić. Drugim zadaniem jest generowanie eventów związanych z czasem i opóźnieniami.</p>
<h2><a class="anchor" id="pipelineScheme"></a>
Schemat potoku przetwarzania obiektów</h2>
<div class="image">
<img src="documentation/pipeline.jpg" alt="pipeline.jpg"/>
</div>
 </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Sep 20 2015 00:00:14 for SWEngine by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
